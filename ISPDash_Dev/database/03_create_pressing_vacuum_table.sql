-- =============================================
-- 創建壓合車間真空曲線資料表
-- =============================================

USE ISPDash;
GO

-- 檢查資料表是否存在，如果存在則刪除
IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Pressing_VacuumHistory]') AND type in (N'U'))
BEGIN
    DROP TABLE [dbo].[Pressing_VacuumHistory];
    PRINT '已刪除現有的 Pressing_VacuumHistory 資料表';
END
GO

-- 創建壓合車間真空曲線資料表
CREATE TABLE [dbo].[Pressing_VacuumHistory] (
    [ID] INT IDENTITY(1,1) NOT NULL,
    [EquipmentID] VARCHAR(50) NOT NULL,
    [RecordTime] DATETIME2(3) NOT NULL,
    [VacuumPressure] DECIMAL(5,2) NOT NULL,  -- 真空壓力 (Torr)
    [Temperature] DECIMAL(5,2) NULL,          -- 溫度 (°C)
    [Pressure] DECIMAL(5,2) NULL,             -- 壓力 (Bar)
    [Status] NVARCHAR(20) NOT NULL DEFAULT 'NORMAL', -- 狀態: NORMAL, WARNING, ALARM
    [CreatedTime] DATETIME2(3) NOT NULL DEFAULT GETDATE(),
    
    -- 主鍵約束
    CONSTRAINT [PK_Pressing_VacuumHistory] PRIMARY KEY CLUSTERED ([ID] ASC)
);
GO

-- 創建索引
CREATE NONCLUSTERED INDEX [IX_Pressing_VacuumHistory_Equipment] ON [dbo].[Pressing_VacuumHistory] ([EquipmentID] ASC);
CREATE NONCLUSTERED INDEX [IX_Pressing_VacuumHistory_Time] ON [dbo].[Pressing_VacuumHistory] ([RecordTime] ASC);
CREATE NONCLUSTERED INDEX [IX_Pressing_VacuumHistory_EquipmentTime] ON [dbo].[Pressing_VacuumHistory] ([EquipmentID] ASC, [RecordTime] ASC);
GO

-- 添加檢查約束
ALTER TABLE [dbo].[Pressing_VacuumHistory] 
ADD CONSTRAINT [CK_Pressing_VacuumHistory_VacuumPressure] 
CHECK ([VacuumPressure] >= 0 AND [VacuumPressure] <= 10);
GO

ALTER TABLE [dbo].[Pressing_VacuumHistory] 
ADD CONSTRAINT [CK_Pressing_VacuumHistory_Temperature] 
CHECK ([Temperature] >= 0 AND [Temperature] <= 200);
GO

ALTER TABLE [dbo].[Pressing_VacuumHistory] 
ADD CONSTRAINT [CK_Pressing_VacuumHistory_Pressure] 
CHECK ([Pressure] >= 0 AND [Pressure] <= 10);
GO

ALTER TABLE [dbo].[Pressing_VacuumHistory] 
ADD CONSTRAINT [CK_Pressing_VacuumHistory_Status] 
CHECK ([Status] IN ('NORMAL', 'WARNING', 'ALARM'));
GO

PRINT 'Pressing_VacuumHistory 資料表創建完成！';
GO

-- =============================================
-- 插入範例資料
-- =============================================

-- 插入 P01A 設備的真空曲線資料 (00:00-23:00, 每小時一筆)
INSERT INTO [dbo].[Pressing_VacuumHistory] ([EquipmentID], [RecordTime], [VacuumPressure], [Temperature], [Pressure], [Status]) VALUES
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 00:00:00', 2.10, 78.5, 1.8, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 01:00:00', 2.30, 79.2, 1.9, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 02:00:00', 2.80, 80.1, 2.0, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 03:00:00', 3.20, 81.5, 2.1, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 04:00:00', 3.50, 82.8, 2.2, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 05:00:00', 3.80, 83.9, 2.3, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 06:00:00', 4.10, 84.7, 2.4, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 07:00:00', 4.50, 85.6, 2.5, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 08:00:00', 4.80, 86.9, 2.6, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 09:00:00', 5.20, 88.3, 2.7, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 10:00:00', 5.60, 89.7, 2.8, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 11:00:00', 6.10, 91.2, 2.9, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 12:00:00', 6.50, 92.8, 3.0, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 13:00:00', 6.80, 94.1, 3.1, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 14:00:00', 6.40, 93.2, 3.0, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 15:00:00', 6.00, 92.1, 2.9, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 16:00:00', 5.50, 90.8, 2.7, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 17:00:00', 5.10, 89.3, 2.6, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 18:00:00', 4.70, 87.9, 2.4, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 19:00:00', 4.30, 86.4, 2.3, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 20:00:00', 3.90, 85.1, 2.1, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 21:00:00', 3.50, 83.8, 2.0, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 22:00:00', 3.10, 82.5, 1.9, 'NORMAL'),
('P01A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 23:00:00', 2.80, 81.2, 1.8, 'NORMAL');

-- 插入 P01B 設備的真空曲線資料 (00:00-23:00, 每小時一筆)
INSERT INTO [dbo].[Pressing_VacuumHistory] ([EquipmentID], [RecordTime], [VacuumPressure], [Temperature], [Pressure], [Status]) VALUES
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 00:00:00', 1.50, 76.2, 1.6, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 01:00:00', 1.70, 77.1, 1.7, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 02:00:00', 2.00, 78.3, 1.8, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 03:00:00', 2.30, 79.6, 1.9, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 04:00:00', 2.60, 80.9, 2.0, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 05:00:00', 2.90, 82.2, 2.1, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 06:00:00', 3.20, 83.5, 2.2, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 07:00:00', 3.60, 84.8, 2.3, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 08:00:00', 4.00, 86.1, 2.4, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 09:00:00', 4.40, 87.4, 2.5, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 10:00:00', 4.80, 88.7, 2.6, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 11:00:00', 5.20, 90.0, 2.7, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 12:00:00', 5.60, 91.3, 2.8, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 13:00:00', 5.90, 92.6, 2.9, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 14:00:00', 5.50, 91.8, 2.8, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 15:00:00', 5.10, 90.9, 2.7, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 16:00:00', 4.70, 89.7, 2.5, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 17:00:00', 4.30, 88.4, 2.4, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 18:00:00', 3.90, 87.1, 2.2, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 19:00:00', 3.50, 85.8, 2.1, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 20:00:00', 3.10, 84.5, 2.0, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 21:00:00', 2.70, 83.2, 1.9, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 22:00:00', 2.30, 81.9, 1.8, 'NORMAL'),
('P01B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 23:00:00', 2.00, 80.6, 1.7, 'NORMAL');

-- 插入 P02A 設備的真空曲線資料 (00:00-23:00, 每小時一筆，較低效率)
INSERT INTO [dbo].[Pressing_VacuumHistory] ([EquipmentID], [RecordTime], [VacuumPressure], [Temperature], [Pressure], [Status]) VALUES
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 00:00:00', 0.80, 74.1, 1.3, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 01:00:00', 1.00, 75.3, 1.4, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 02:00:00', 1.30, 76.5, 1.5, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 03:00:00', 1.60, 77.7, 1.6, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 04:00:00', 1.90, 78.9, 1.7, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 05:00:00', 2.20, 80.1, 1.8, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 06:00:00', 2.50, 81.3, 1.9, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 07:00:00', 2.80, 82.5, 2.0, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 08:00:00', 3.10, 83.7, 2.1, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 09:00:00', 3.40, 84.9, 2.2, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 10:00:00', 3.70, 86.1, 2.3, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 11:00:00', 4.00, 87.3, 2.4, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 12:00:00', 4.30, 88.5, 2.5, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 13:00:00', 4.60, 89.7, 2.6, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 14:00:00', 4.20, 88.9, 2.5, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 15:00:00', 3.80, 88.1, 2.4, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 16:00:00', 3.40, 87.3, 2.3, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 17:00:00', 3.00, 86.5, 2.2, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 18:00:00', 2.60, 85.7, 2.1, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 19:00:00', 2.20, 84.9, 2.0, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 20:00:00', 1.80, 84.1, 1.9, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 21:00:00', 1.40, 83.3, 1.8, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 22:00:00', 1.10, 82.5, 1.7, 'WARNING'),
('P02A', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 23:00:00', 0.80, 81.7, 1.6, 'WARNING');

-- 插入 P02B 設備的真空曲線資料 (00:00-23:00, 每小時一筆，高效率)
INSERT INTO [dbo].[Pressing_VacuumHistory] ([EquipmentID], [RecordTime], [VacuumPressure], [Temperature], [Pressure], [Status]) VALUES
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 00:00:00', 0.30, 82.5, 2.0, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 01:00:00', 0.50, 83.7, 2.1, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 02:00:00', 0.80, 84.9, 2.2, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 03:00:00', 1.10, 86.1, 2.3, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 04:00:00', 1.40, 87.3, 2.4, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 05:00:00', 1.70, 88.5, 2.5, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 06:00:00', 2.00, 89.7, 2.6, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 07:00:00', 2.30, 90.9, 2.7, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 08:00:00', 2.60, 92.1, 2.8, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 09:00:00', 2.90, 93.3, 2.9, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 10:00:00', 3.20, 94.5, 3.0, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 11:00:00', 3.50, 95.7, 3.1, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 12:00:00', 3.80, 96.9, 3.2, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 13:00:00', 4.10, 97.1, 3.3, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 14:00:00', 3.70, 96.3, 3.2, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 15:00:00', 3.30, 95.5, 3.1, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 16:00:00', 2.90, 94.7, 3.0, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 17:00:00', 2.50, 93.9, 2.9, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 18:00:00', 2.10, 93.1, 2.8, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 19:00:00', 1.70, 92.3, 2.7, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 20:00:00', 1.30, 91.5, 2.6, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 21:00:00', 0.90, 90.7, 2.5, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 22:00:00', 0.60, 89.9, 2.4, 'NORMAL'),
('P02B', CAST(CAST(GETDATE() AS DATE) AS VARCHAR(10)) + ' 23:00:00', 0.30, 89.1, 2.3, 'NORMAL');
GO

-- 顯示插入的資料數量
SELECT COUNT(*) AS '插入的真空曲線資料筆數' FROM [dbo].[Pressing_VacuumHistory];
GO

-- 顯示各設備的資料統計
SELECT 
    [EquipmentID],
    COUNT(*) AS '資料筆數',
    MIN([VacuumPressure]) AS '最小真空壓力',
    MAX([VacuumPressure]) AS '最大真空壓力',
    AVG([VacuumPressure]) AS '平均真空壓力'
FROM [dbo].[Pressing_VacuumHistory]
GROUP BY [EquipmentID]
ORDER BY [EquipmentID];
GO

PRINT '壓合車間真空曲線資料表創建和範例資料插入完成！';
GO
